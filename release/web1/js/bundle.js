!function(){"use strict";class t extends Laya.Script{constructor(){super()}onAwake(){Laya.Scene3D.load("res/unityscene/LayaScene_Forest/Conventional/Forest.ls",new Laya.Handler(this,function(t){this.owner.addChild(t)}))}}class e extends Laya.Script{constructor(){super()}}e.Regist_CREQ="Regist_CREQ",e.Regist_Fail="Regist_Fail",e.Regist_Success="Regist_Success",e.Login_CREQ="Login_CREQ",e.Login_Fail="Login_Fail",e.Login_Success="Login_Success",e.ChangeSpecies_CREQ="ChangeSpecies_CREQ",e.ChangeSpecies_SRES="ChangeSpecies_SRES";class a extends Laya.Script{constructor(){super()}}a.Account="Account",a.Match="Match",a.Fight="Fight";class s extends Laya.Script{constructor(){super()}}s.Connect="connect",s.Connect_error="connect_error",s.ClientMsg="ClientMsg",s.ServerMsg="ServerMsg",s.ShowHint="ShowHint";class i extends Laya.Script{constructor(){super()}}i.ShowRigistPanel="ShowRigistPanel",i.ShowLoginPanel="ShowLoginPanel",i.SendMsg="SendMsg",i.ShowSpecies_Bird="ShowSpecies_Bird",i.Match_Succ="Match_Succ",i.Match_OtherEnter="Match_OtherEnter",i.Match_Leave_Self="Match_Leave_Self",i.Match_Leave_Other="Match_Leave_Other",i.InitPos="InitPos",i.UpdatePos="UpdatePos",i.UpdateFly="UpdateFly",i.UpdateMotion="UpdateMotion",i.ReceiveChatMsg="ReceiveChatMsg";class n extends Laya.Script{constructor(){super(),this.btn_Regist=null,this.btn_Login=null,this.input_Name=null,this.input_Pwd=null}onAwake(){Laya.stage.on(i.ShowLoginPanel,this,function(){this.owner.visible=!0}),this.btn_Regist.on(Laya.Event.CLICK,this,function(){this.input_Name.text="",this.input_Pwd.text="",this.owner.visible=!1,Laya.stage.event(i.ShowRigistPanel)}),this.btn_Login.on(Laya.Event.CLICK,this,this.OnLoginBtnClick)}OnLoginBtnClick(){if(""!=this.input_Name.text&&null!=this.input_Name.text)if(""!=this.input_Pwd.text&&null!=this.input_Pwd.text){var t={Username:this.input_Name.text,Pwd:this.input_Pwd.text};Laya.stage.event(i.SendMsg,[a.Account,e.Login_CREQ,t])}else Laya.stage.event(s.ShowHint,"请输入密码！");else Laya.stage.event(s.ShowHint,"请输入用户名！")}}class o extends Laya.Script{constructor(){super(),this.btn_Back=null,this.input_Name=null,this.input_Pwd=null}onAwake(){this.btn_Back.on(Laya.Event.CLICK,this,function(){this.input_Name.text="",this.input_Pwd.text="",this.owner.visible=!1,Laya.stage.event(i.ShowLoginPanel)}),Laya.stage.on(i.ShowRigistPanel,this,function(){this.owner.visible=!0}),this.owner.getChildByName("btn_Regist").on(Laya.Event.CLICK,this,this.RegistBtnClick)}RegistBtnClick(){if(""!=this.input_Name.text&&null!=this.input_Name.text)if(""!=this.input_Pwd.text&&null!=this.input_Pwd.text){var t={Username:this.input_Name.text,Pwd:this.input_Pwd.text};Laya.stage.event(i.SendMsg,[a.Account,e.Regist_CREQ,t])}else Laya.stage.event(s.ShowHint,"请输入密码！");else Laya.stage.event(s.ShowHint,"请输入用户名！")}}class r extends Laya.Script{constructor(){super(),this.xx=null}onAwake(){Laya.stage.on(s.ShowHint,this,this.Show)}Show(t){Laya.Tween.clearAll(this.owner),Laya.timer.clearAll(this),this.owner.y=800,this.owner.text=t,this.owner.visible=!0,Laya.Tween.to(this.owner,{alpha:1},200),Laya.Tween.to(this.owner,{y:566},500,null,new Laya.Handler(this,function(){Laya.timer.once(500,this,function(){Laya.Tween.to(this.owner,{y:340,alpha:0},500,null,new Laya.Handler(this,function(){this.owner.visible=!1}))})}))}}class h extends Laya.Script{constructor(){super()}}h.Id=-1,h.UserName="",h.Win=-1,h.Lose=-1,h.Species=-1,h.Type=-1,h.PlayerIdPosArr=new Array;class l extends Laya.Script{constructor(){super()}}l.StartGame="StartGame",l.Match_Succ="Match_Succ",l.Match_OtherEnter="Match_OtherEnter",l.Match_LeaveCREQ="Match_LeaveCREQ",l.Match_LeaveSRES="Match_LeaveSRES",l.Pos_Init_CREQ="Pos_Init_CREQ",l.Pos_Init_SRES="Pos_Init_SRES",l.Pos_CREQ="Pos_CREQ",l.Pos_SRES="Pos_SRES",l.Fly_CREQ="Fly_CREQ",l.Fly_SRES="Fly_SRES",l.Motion_CREQ="Motion_CREQ",l.Motion_SRES="Motion_SRES",l.Chat_SEND="Chat_SEND",l.Chat_RECEIVE="Chat_RECEIVE";class c extends Laya.Script{constructor(){super()}onAwake(){var t=io.connect("ws://114.55.173.51:9000");t.on(s.Connect,function(){console.log("连接成功")}),t.on(s.Connect_error,function(){console.log("连接服务器失败，原因可能是服务器没有启动")}),t.on(s.ServerMsg,function(t,n,o){switch(t){case a.Account:n==e.Regist_Fail&&Laya.stage.event(s.ShowHint,"用户名已存在"),n==e.Regist_Success&&Laya.stage.event(s.ShowHint,"注册成功"),n==e.Login_Fail&&Laya.stage.event(s.ShowHint,o),n==e.Login_Success&&(console.log("登录成功",o),h.Id=o.Id,h.UserName=o.UserName,h.Win=o.Win,h.Lose=o.Lose,h.Type=o.Type,h.Species=o.Species,Laya.Scene.open("MatchScene.json")),n==e.ChangeSpecies_SRES&&console.log("修改成功",o);break;case a.Match:break;case a.Fight:n==l.Match_OtherEnter&&(console.log("Match_OtherEnter",o),Laya.stage.event(i.Match_OtherEnter,o)),n==l.Match_Succ&&(console.log("Match_Succ",o),Laya.stage.event(i.Match_Succ,[o])),n==l.Match_LeaveSRES&&(o==h.Id?(console.log("自身玩家离开了"),Laya.stage.event(i.Match_Leave_Self)):(console.log("其他玩家离开了"),Laya.stage.event(i.Match_Leave_Other,o))),n==l.Pos_Init_SRES&&Laya.stage.event(i.InitPos,o),n==l.Pos_SRES&&Laya.stage.event(i.UpdatePos,o),n==l.Fly_SRES&&Laya.stage.event(i.UpdateFly,o),n==l.Motion_SRES&&Laya.stage.event(i.UpdateMotion,o),n==l.Chat_RECEIVE&&Laya.stage.event(i.ReceiveChatMsg,o)}}),Laya.stage.on(i.SendMsg,this,function(e,a,i){t.emit(s.ClientMsg,e,a,i)})}}class y extends Laya.Script{constructor(){super()}onAwake(){this.owner.parent.addComponent(c)}}class g extends Laya.Script{constructor(){super()}static getAnimalName(t,e){return t in d&&e in d[t]?d[t][e]:"unknown"}static getAnimalName_CN(t,e){return t in u&&e in u[t]?u[t][e]:"未知"}}var d={0:{0:"RedWhiskeredBulbul",1:"AbbottBooby",2:"AbyssinianRoller",3:"AleutianTern",4:"AndeanCondor",5:"ArchersBuzzard",6:"ArtilleanCrestedHummingBird",7:"Babbler",8:"BarbaryFalcon",9:"BlackHeadedWeaver",10:"BlackStork",11:"BlueCrane",12:"BlueJay",13:"CaliforniaCondor",14:"Cicadabird",15:"Cisticola",16:"CollaredFalconet",17:"CommonRail",18:"CommonScimitarbil",19:"Crimsonwing",20:"CurlCrestedJay",21:"Drongo",22:"EuropeanStarling",23:"EveningGrosbeak",24:"GrayCrownedCrane",25:"GrayFlycatcher",26:"GreatTit",27:"GreenKingfisher",28:"GreyTit",29:"Gyrfalcon",30:"HarpyEagle",31:"LavenderWaxbill",32:"MaghrebLark",33:"NorthernWheatear",34:"PhillipineDwarfKingfisher",35:"PinkRobin",36:"PrairieFalcon",37:"RedShoulderedHawk",38:"YellowThroatedLongclaw",39:"SacredKingfisher",40:"SarusCrane",41:"SlatyLeggedCrake",42:"Starling",43:"Swift",44:"Thrush",45:"TibetanSnowfinch",46:"Towhee",47:"Warbler",48:"Weka",49:"WhiteBelliedSeaEagle",50:"WhiteCheekedBarbet",51:"WhiteStork",52:"WhiteThroatedMagpieJay",53:"YellowBilledStork",54:"Sparrow",55:"Penguin",56:"SnowOwl",57:"Chick",58:"Duck",59:"Hen",60:"Rooster",61:"Crow",62:"Eagle",63:"Hornbill",64:"Owl",65:"Dove",66:"Parrot",67:"Pigeon",68:"Flamingo",69:"Ostrich",70:"GoldenEagle",71:"Emu",72:"Kookaburra",73:"Kingfisher",74:"Swan",75:"Pelican",76:"Puffin",77:"Goose",78:"Mallard",79:"Turkey",80:"Cardinal",81:"Toucan",82:"Vulture",83:"Woodpecker",84:"Kakapo",85:"Kiwi",86:"Quail",87:"Macaw",88:"Shoebill",89:"Seagull"},1:{0:"鸸鹋",1:"黄鼬",2:"石龙子",3:"猫"},1:{0:"杜鹃",1:"老鼠",2:"鳄鱼",3:"壁虎"}},u={0:{0:"红耳鹎",1:"粉嘴鲣鸟",2:"蓝头佛法僧",3:"白腰燕鸥",4:"安第斯神鹫",5:"索马里鵟",6:"凤头蜂鸟",7:"弯嘴鹛",8:"游隼",9:"黑头黄背织雀",10:"黑鹳",11:"蓝蓑羽鹤",12:"冠蓝鸦",13:"加州神鹫",14:"鹃鵙",15:"扇尾莺",16:"红腿小隼",17:"普通秧鸡",18:"弯嘴林戴胜",19:"红脸朱翅雀",20:"卷冠蓝鸦",21:"发冠卷尾",22:"紫翅椋鸟",23:"黄昏锡嘴雀",24:"灰冕鹤",25:"灰纹霸鹟",26:"大山雀",27:"绿鱼狗",28:"灰山雀",29:"矛隼",30:"角雕",31:"淡蓝梅花雀",32:"马格里布凤头百灵",33:"穗䳭",34:"菲律宾三趾翠鸟",35:"粉红鸲鹟",36:"草原隼",37:"赤肩鵟",38:"黄喉长爪鹡鸰",39:"白眉翡翠",40:"赤颈鹤",41:"白喉斑秧鸡",42:"椋鸟(亚成)",43:"雨燕",44:"宝兴歌鸫",45:"藏雪雀",46:"棕胁唧鹀",47:"林柳莺",48:"新西兰秧鸡",49:"白腹海雕",50:"小绿拟啄木鸟",51:"白鹳",52:"白喉鹊鸦",53:"黄嘴鹮鹳",54:"麻雀",55:"企鹅",56:"雪鸮",57:"小鸡",58:"鸭",59:"母鸡",60:"公鸡",61:"乌鸦",62:"白头海雕",63:"马来犀鸟",64:"猫头鹰",65:"灰斑鸠",66:"鹦鹉",67:"岩鸽",68:"火烈鸟",69:"非洲鸵鸟",70:"金雕",71:"鸸鹋",72:"笑翠鸟",73:"翠鸟",74:"天鹅",75:"鹈鹕",76:"北极海鹦",77:"鹅",78:"绿头鸭",79:"火鸡",80:"主红雀",81:"巨嘴鸟",82:"兀鹫",83:"啄木鸟",84:"鸮面鹦鹉",85:"几维鸟",86:"翎鹑",87:"蓝黄金刚鹦鹉",88:"鲸头鹳",89:"海鸥"},1:{0:"鸸鹋",1:"黄鼬",2:"石龙子",3:"猫"},1:{0:"杜鹃",1:"老鼠",2:"鳄鱼",3:"壁虎"}};class L extends Laya.Script{constructor(){super(),this.btn_startgame=null,this.btn_bird=null}onAwake(){this.owner.getChildByName("top").getChildByName("txt_Username").text="用户名："+h.UserName,this.titleUpdate(),this.owner.getChildByName("top").getChildByName("headicon").skin="UI/icon"+h.Type+"/"+h.Species+".png",this.btn_bird.on(Laya.Event.CLICK,this.btn_bird,function(){Laya.stage.event(i.ShowSpecies_Bird)}),Laya.stage.on("Choose",this,function(){this.titleUpdate();var t={Type:h.Type,Species:h.Species};Laya.stage.event(i.SendMsg,[a.Account,e.ChangeSpecies_CREQ,t])}),this.btn_startgame.on(Laya.Event.CLICK,this.btn_startgame,function(){Laya.stage.event(i.SendMsg,[a.Fight,l.StartGame,null]),Laya.Scene.open("TestScene.json")})}onUpdate(){}titleUpdate(){const t=g.getAnimalName(h.Type,h.Species),e=g.getAnimalName_CN(h.Type,h.Species);this.owner.getChildByName("top").getChildByName("txt_EN").text=t,this.owner.getChildByName("top").getChildByName("txt_CN").text=e}}class p extends Laya.Script{constructor(){super(),this.speciesList=null,this.btn_right=null,this.page=0,this.animaltype=-1}onAwake(){this.animaltype=h.Type,this.btn_right.on(Laya.Event.CLICK,this,function(){0==this.animaltype&&(this.pageTurn(this.page,5),this.pageShow(this.page,0))}),Laya.stage.on(i.ShowSpecies_Bird,this,function(){this.animaltype=0,this.pageShow(this.page,0),Laya.Tween.to(this.owner,{scaleX:1,scaleY:1},100)}),this.owner.getChildByName("Panel").getChildByName("btn_Close").on(Laya.Event.CLICK,this,function(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0},100)}),this.speciesList.mouseHandler=new Laya.Handler(this,function(t,e){t.type==Laya.Event.CLICK&&(h.Type=this.animaltype,h.Species=e+15*this.page,Laya.Tween.to(this.owner,{scaleX:0,scaleY:0},100),Laya.stage.event("Choose"))})}onDestroy(){Laya.loader.clearRes("res/atlas/UI/icon0.atlas"),Laya.loader.clearRes("res/atlas/UI/touxiang.atlas"),Laya.loader.clearRes("res/atlas/comp.atlas"),Laya.loader.clearRes("res/atlas/UI.atlas"),Laya.stage.off(i.ShowSpecies_Bird,this),Laya.stage.off("Choose",this)}pageTurn(t,e){this.page=t,this.page>=e?this.page=0:this.page=this.page+1}pageShow(t,e){if(this.page=t,this.animaltype==e)for(var a=15*this.page;a<15*this.page+15;a++)this.speciesList.getCell(a).getChildByName("icon").skin="UI/icon"+e+"/"+a+".png",h.Species==a?this.speciesList.getCell(a-15*this.page).getChildByName("choose").visible=!0:this.speciesList.getCell(a-15*this.page).getChildByName("choose").visible=!1}}class m extends Laya.Script{constructor(){super(),this.scene=null,this.model=null}onAwake(){Laya.Scene3D.load("res/unityscene/LayaScene_ShowScene/Conventional/ShowScene.ls",Laya.Handler.create(this,function(t){this.scene=t,Laya.stage.addChild(t),t.zOrder=-1;var e=t.getChildByName("Main Camera");e.transform.translate(new Laya.Vector3(0,.3,0)),e.clearFlag=Laya.BaseCamera.CLEARFLAG_SOLIDCOLOR,this.loadModel()})),Laya.stage.on("Choose",this,function(){this.removeModel(),this.loadModel()})}onDestroy(){this.scene.destroy(),Laya.Resource.destroyUnusedResources()}loadModel(){const t="res/unityscene/LayaScene_ShowScene/Conventional/"+g.getAnimalName(h.Type,h.Species)+"_LOD0.lh";Laya.Sprite3D.load(t,Laya.Handler.create(this,function(t){this.model=this.scene.addChild(t)}))}removeModel(){this.model.destroy(),Laya.Resource.destroyUnusedResources()}}class S extends Laya.Script{constructor(){super(),this.target=null,this.out=new Laya.Vector3,this.followSpeed=10,this.curTouchId=null,this.originPoint=new Laya.Point,this.originRotate=new Laya.Vector3,this._tempV3=new Laya.Vector3(0,0,0),this._speed=.1}Init(t){this.target=t,Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp)}onAwake(){this.isleftControl=!1}onLateUpdate(){null!=this.target&&this.UpdateRotPos()}onMouseDown(t){if(this.isleftControl){if(t.stageX>Laya.stage.width/2||this.isDown)return}else if(t.stageX<Laya.stage.width/2||this.isDown)return;this.curTouchId=t.touchId,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMove),this.originPoint.x=t.stageX,this.originPoint.y=t.stageY,this.originRotate=this.owner.transform.rotationEuler.clone()}onMove(t){if(this.curTouchId&&t.touchId!=this.curTouchId)return;let e=(t.stageX-this.originPoint.x)*this._speed,a=(t.stageY-this.originPoint.y)*this._speed,s=this.originRotate.x-a,i=this.originRotate.y-e;this._tempV3.y=i,this._tempV3.x=s>=50?50:s<=-70?-70:s}onMouseUp(t){t.touchId==this.curTouchId&&(Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMove),this.originPoint.reset(),this.curTouchId=null,this.originRotate=null)}UpdateRotPos(){if(this._tempV3){let t=this.owner.transform;Laya.Vector3.lerp(t.rotationEuler,this._tempV3,this._speed,t.rotationEuler),t.rotationEuler=t.rotationEuler}if(this._tempV3){var t=new Laya.Quaternion;Laya.Quaternion.createFromYawPitchRoll(this._tempV3.y*Math.PI/180,this._tempV3.x*Math.PI/180,this._tempV3.z*Math.PI/180,t);var e=new Laya.Vector3;Laya.Vector3.transformQuat(new Laya.Vector3(0,0,-1),t,e);var a=new Laya.Vector3;Laya.Vector3.scale(e,5,e),Laya.Vector3.subtract(this.target.transform.position,e,a),Laya.Vector3.lerp(this.owner.transform.position,a,this._speed,this.out),this.owner.transform.position=this.out}}}class w extends Laya.Script3D{constructor(){super(),this.character=null,this.camera=null,this.playerText=null,this.speed=0,this.state=0,this.direction=new Laya.Vector3,this.flyForce=0,this.jumpForce=0,this.lastPosX=0,this.lastPosY=0,this.lastPosZ=0,this.lastAngle=0,this.txtpoint=new Laya.Vector4}Init(t,e){this.camera=t,this.playerText=e}onAwake(){Laya.stage.on("OnMove",this,function(t){this.speed=t}),Laya.stage.on("OnRotate",this,function(t){this.owner.transform.localRotationEulerY=t+this.camera.transform.rotationEuler.y,console.log("dhiauh",this.camera.transform.rotationEuler.y,t)}),Laya.stage.on("Fly",this,function(){this.owner.getComponent(Laya.CharacterController).jump(),Laya.stage.event(i.SendMsg,[a.Fight,l.Fly_CREQ,h.Id])}),Laya.stage.on("Eat",this,function(){this.state=1}),Laya.stage.on("Sit",this,function(){this.state=2}),Laya.stage.on("Spin",this,function(){this.state=3}),Laya.stage.on("Roll",this,function(){this.state=4}),Laya.stage.on("Fear",this,function(){this.state=5}),Laya.stage.on("Bounce",this,function(){this.state=6}),Laya.stage.on("UpdateMotion_start",this,function(){var t={Id:h.Id,state:this.state};Laya.stage.event(i.SendMsg,[a.Fight,l.Motion_CREQ,t])}),this.addCharacter(),this.addAnim()}onEnable(){}onUpdate(){if(this.camera.worldToViewportPoint(this.owner.transform.position,this.txtpoint),this.playerText.pos(this.txtpoint.x,this.txtpoint.y),this.playerText.getChildByName("followtext").text=h.UserName,this.playerText.scale(1,1),this.owner.transform.getForward(this.direction),0!=this.speed&&(this.character.isGrounded?this.character.isGrounded&&(this.owner.transform.localPositionX+=-1*this.direction.x*this.speed/100,this.owner.transform.localPositionZ+=-1*this.direction.z*this.speed/100):(this.owner.transform.localPositionX+=-1*this.direction.x*this.speed*2/100,this.owner.transform.localPositionZ+=-1*this.direction.z*this.speed*2/100)),this.lastPosX!=this.owner.transform.localPositionX||this.lastPosZ!=this.owner.transform.localPositionZ||this.lastAngle!=this.owner.transform.localRotationEulerY){var t={Id:h.Id,x:this.owner.transform.localPositionX,z:this.owner.transform.localPositionZ,Angle:this.owner.transform.localRotationEulerY};Laya.stage.event(i.SendMsg,[a.Fight,l.Pos_CREQ,t])}this.lastPosX=this.owner.transform.localPositionX,this.lastPosZ=this.owner.transform.localPositionZ,this.lastAngle=this.owner.transform.localRotationEulerY,Laya.stage.on(i.Match_OtherEnter,this,function(t){Laya.timer.once(100,this,function aaa(){var t={Id:h.Id,x:this.owner.transform.localPositionX,y:this.owner.transform.localPositionY,z:this.owner.transform.localPositionZ,Angle:this.owner.transform.localRotationEulerY};Laya.stage.event(i.SendMsg,[a.Fight,l.Pos_Init_CREQ,t]),Laya.timer.clear(this,aaa)})})}onDestroy(){Laya.stage.off("OnMove",this),Laya.stage.off("OnRotate",this)}addCharacter(){var t=this.owner.addComponent(Laya.CharacterController);this.character=t;var e=new Laya.CapsuleColliderShape(.4,.9);e.localOffset=new Laya.Vector3(0,.4,0),t.colliderShape=e,Laya.timer.frameLoop(1,this,this.onKeyDown)}onKeyDown(){let t=this.owner.getComponent(Laya.CharacterController);Laya.KeyBoardManager.hasKeyDown(32)&&(t.jump(),Laya.stage.event(i.SendMsg,[a.Fight,l.Fly_CREQ,h.Id]))}addAnim(){Laya.timer.frameLoop(1,this,this.Anim)}Anim(){var t=this.owner.getComponent(Laya.Animator);let e=this.owner.getComponent(Laya.CharacterController);if(t.speed=.5,e.isGrounded){if(e.isGrounded)if(0!=this.speed)t.play("Walk"),this.state=0;else switch(this.state){case 1:t.play("Eat"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[1]),this.eatTimerRunning=!0);break;case 2:t.play("Sit",0);break;case 3:t.play("Spin"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[3]),this.eatTimerRunning=!0);break;case 4:t.play("Roll"),this.owner.transform.getForward(this.direction),this.owner.transform.localPositionX+=-1*this.direction.x*.01,this.owner.transform.localPositionZ+=-1*this.direction.z*.01,this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[1]),this.eatTimerRunning=!0);break;case 5:t.play("Fear"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[3]),this.eatTimerRunning=!0);break;case 6:t.play("Bounce");break;default:0!=this.speed?t.play("Walk"):t.play("Idle_A"),this.state=0}}else t.play("Fly"),this.state=0}checkAnimation(t){var e=t;this.owner.getComponent(Laya.Animator).getCurrentAnimatorPlayState().normalizedTime>=e&&(this.state=0,Laya.timer.clear(this,this.checkAnimation),this.eatTimerRunning=!1)}}class _ extends Laya.Script{constructor(){super(),this.Id=-1,this.username="",this.camera=null,this.playerText=null,this.speed=0,this.state=0,this.lastPosX=0,this.lastPosZ=0,this.lastAngle=0,this.txtpoint=new Laya.Vector4}Init(t,e,a,s){this.Id=t,this.username=s,this.camera=e,this.playerText=a,console.log("camera",this.camera)}onAwake(){Laya.stage.on(i.Match_Leave_Other,this,function(t){t==this.Id&&(this.playerText.destroy(),this.owner.destroy())}),Laya.stage.on(i.InitPos,this,function(t){t.Id==this.Id&&(this.owner.transform.localPositionX=t.x,this.owner.transform.localPositionY=t.y,this.owner.transform.localPositionZ=t.z,this.owner.transform.localRotationEulerY=t.Angle)}),Laya.stage.on(i.UpdatePos,this,function(t){t.Id==this.Id&&(this.owner.transform.localPositionX=t.x,this.owner.transform.localPositionZ=t.z,this.owner.transform.localRotationEulerY=t.Angle,this.lastPosX=this.owner.transform.localPositionX,this.lastPosZ=this.owner.transform.localPositionZ,this.lastAngle=this.owner.transform.localRotationEulerY,0==this.state?this.speed=100:0!=this.state&&(this.speed=100))}),Laya.stage.on(i.UpdateFly,this,function(t){let e=this.owner.getComponent(Laya.CharacterController);t==this.Id&&e.jump()}),Laya.stage.on(i.UpdateMotion,this,function(t){t.Id==this.Id&&(this.state=t.state)}),this.addCharacter(),this.addAnim()}onUpdate(){this.camera.worldToViewportPoint(this.owner.transform.position,this.txtpoint),this.playerText.pos(this.txtpoint.x,this.txtpoint.y),this.playerText.scale(5*this.txtpoint.z/this.txtpoint.w,5*this.txtpoint.z/this.txtpoint.w),this.playerText.scaleX<.25?this.playerText.getChildByName("followtext").text="":this.playerText.getChildByName("followtext").text=this.username,this.lastPosX!=this.owner.transform.localPositionX||this.lastPosZ!=this.owner.transform.localPositionZ||(this.speed=0)}onDestroy(){Laya.stage.off(i.UpdatePos,this),Laya.stage.off(i.UpdateFly,this)}addCharacter(){var t=this.owner.addComponent(Laya.CharacterController),e=new Laya.CapsuleColliderShape(.4,.9);e.localOffset=new Laya.Vector3(0,.4,0),t.colliderShape=e}addAnim(){Laya.timer.frameLoop(1,this,this.Anim)}Anim(){var t=this.owner.getComponent(Laya.Animator);let e=this.owner.getComponent(Laya.CharacterController);if(t.speed=.5,e.isGrounded){if(e.isGrounded)if(0!=this.speed)t.play("Walk"),this.state=0;else switch(this.state){case 1:t.play("Eat"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[1]),this.eatTimerRunning=!0);break;case 2:t.play("Sit",0);break;case 3:t.play("Spin"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[3]),this.eatTimerRunning=!0);break;case 4:t.play("Roll"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[1]),this.eatTimerRunning=!0);break;case 5:t.play("Fear"),this.eatTimerRunning||(Laya.timer.frameLoop(1,this,this.checkAnimation,[3]),this.eatTimerRunning=!0);break;case 6:t.play("Bounce");break;default:0!=this.speed?t.play("Walk"):t.play("Idle_A"),this.state=0}}else t.play("Fly"),this.state=0}checkAnimation(t){var e=t;this.owner.getComponent(Laya.Animator).getCurrentAnimatorPlayState().normalizedTime>=e&&(this.state=0,Laya.timer.clear(this,this.checkAnimation),this.eatTimerRunning=!1)}}class f extends Laya.Script{constructor(){super(),this.scene=null,this.camera=null,this.idItemObject=new Object,this.playerTextPre=null,this.roomData=null}onAwake(){Laya.loader.load("prefab/PlayerIDTextPre.json",new Laya.Handler(this,function(t){this.playerTextPre=t}),null,Laya.Loader.PREFAB),Laya.Scene3D.load("res/unityscene/LayaScene_Forest/Conventional/Forest.ls",Laya.Handler.create(this,function(t){this.scene=t,console.log("scene1",this.scene),Laya.stage.addChild(t),t.zOrder=-1;var e=t.getChildByName("Main Camera");e.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY,this.camera=e,this.roomData.forEach(t=>{const e=this.createUserModel(t.Id);this.idItemObject[t.Id]=e;const a=g.getAnimalName(t.Type,t.Species),s="res/unityscene/LayaScene_ShowScene/Conventional/"+a+"_LOD0.lh";console.log("加载了",a,s),Laya.Sprite3D.load(s,Laya.Handler.create(this,function(a){var s=this.playerTextPre.create();this.owner.addChild(s),console.log("scene",this.scene);var i=this.scene.addChild(a.clone());e.model=i,console.log("已有-加载完毕"),t.Id==h.Id?(i.addComponent(w).Init(this.camera,s),this.camera.addComponent(S).Init(i)):i.addComponent(_).Init(t.Id,this.camera,s,t.UserName)}))})})),Laya.stage.on(i.Match_Succ,this,function(t){this.roomData=t}),Laya.stage.on(i.Match_OtherEnter,this,function(t){const e=this.createUserModel(t.Id);this.idItemObject[t.Id]=e;const a=g.getAnimalName(t.Type,t.Species),s="res/unityscene/LayaScene_ShowScene/Conventional/"+a+"_LOD0.lh";console.log("加载了",a,s),Laya.Sprite3D.load(s,Laya.Handler.create(this,function(a){var s=this.playerTextPre.create();this.owner.addChild(s);var i=this.scene.addChild(a.clone());e.model=i,console.log("新加入-加载完毕"),i.addComponent(_).Init(t.Id,this.camera,s,t.UserName)}))}),Laya.stage.on(i.Match_Leave_Other,this,function(t){const e=this.idItemObject[t];null!=e&&e.model,delete this.idItemObject[t]}),Laya.stage.on(i.Match_Leave_Self,this,function(){console.log("Match_Leave_Self"),Object.values(this.idItemObject).forEach(t=>{t.destroy()}),this.idItemObject=new Object})}onDestroy(){Laya.stage.off(i.Match_Leave_Self,this),Laya.stage.off(i.Match_Leave_Other,this),Laya.stage.off(i.Match_OtherEnter,this),Laya.stage.off(i.Match_Succ,this),Laya.loader.clearRes("prefab/PlayerFollowTextPre.json")}createUserModel(t){return{id:t,model:null}}}class C extends Laya.Script{constructor(){super(),this.joystick=null,this.knob=null,this.pad=null}onAwake(){this.curTouchId=0,this.isDown=!1,this.angle=-1,this.radians=-1,this.isleftControl=!0,Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp),this.joystick.visible=!1,this.distance=140,this.speed=0}onMouseDown(t){if(this.isleftControl){if(t.stageX>Laya.stage.width/2||this.isDown)return}else if(t.stageX<Laya.stage.width/2||this.isDown)return;this.curTouchId=t.touchId,this.isDown=!0;var e=this.joystick.globalToLocal(new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseY),!1);this.knob.pos(e.x,e.y),this.pad.pos(e.x,e.y),this.originPiont=e,this.joystick.visible=!0,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMove)}onMouseUp(t){t.touchId==this.curTouchId&&(this.isDown=!1,this.joystick.visible=!1,Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMove),this.radians=this.angle=-1,this.speed=0,Laya.stage.event("OnMove",0))}onMove(t){if(t.touchId==this.curTouchId){var e=this.joystick.globalToLocal(new Laya.Point(Laya.stage.mouseX,Laya.stage.mouseY),!1);this.knob.pos(e.x,e.y);var a=e.x-this.originPiont.x,s=e.y-this.originPiont.y;if(this.angle=180*Math.atan2(a,s)/Math.PI,this.angle<0&&(this.angle+=360),this.angle=Math.round(this.angle),this.radians=Math.PI/180*this.angle,a*a+s*s>=this.distance*this.distance){var i=Math.floor(Math.sin(this.radians)*this.distance+this.originPiont.x),n=Math.floor(Math.cos(this.radians)*this.distance+this.originPiont.y);this.knob.pos(i,n)}else this.knob.pos(e.x,e.y);var o=this.knob.x-this.originPiont.x,r=this.knob.y-this.originPiont.y;this.speed=Math.sqrt(o*o+r*r)/this.distance}}onUpdate(){this.speed>0&&Laya.stage.event("OnMove",this.speed),-1!=this.angle&&Laya.stage.event("OnRotate",this.angle)}}class v extends Laya.Script{constructor(){super(),this.btn_send=null,this.chatPanel=null,this.chatInfo=null,this.chatLineArr=new Array,this.msgTotalHeight=0}onAwake(){this.btn_send.on(Laya.Event.CLICK,this,function(){this.onSendMsg()}),Laya.stage.on(i.ReceiveChatMsg,this,function(t){this.msgReceive(t.username,t.msg)}),this.chatPanel.vScrollBarSkin="",this.chatPanel.vScrollBar.isVertical=!0,this.chatPanel.vScrollBar.elasticBackTime=600,this.chatPanel.vScrollBar.elasticDistance=200}onSendMsg(){var t=this.chatInfo.text.trim();if(""!=t){var e={id:h.Id,username:h.UserName,msg:t};Laya.stage.event(i.SendMsg,[a.Fight,l.Chat_SEND,e]),console.log("发送消息",e),this.chatInfo.text=""}}msgReceive(t,e){var a=Laya.Pool.getItemByClass("chatLine",P);a.init(t,e),this.chatPanel.addChild(a),a.y=this.msgTotalHeight,this.msgTotalHeight+=a.height,this.chatLineArr.push(a),this.chatPanel.vScrollBar.max=this.chatPanel.contentHeight,this.chatPanel.vScrollBar.value=this.chatPanel.vScrollBar.max}}class P extends Laya.Box{init(t,e){var a=Date.now(),s=new Date(a),i=s.getHours(),n=s.getMinutes(),o=new Laya.Text;this.addChild(o);var r=i+":"+n+" ["+t+"] "+e,h=(r.match(/[a-zA-Z]/g)||[]).length,l=(r.match(/[\u4e00-\u9fa5]/g)||[]).length,c=(r.match(/[0-9]/g)||[]).length,y=r.length-h-l-c,g=1+Math.floor(h/30+l/22+c/38+y/22);o.height=30*g,o.width=570,o.color="#ffffff",o.font="Microsoft YaHei",o.fontSize=25,o.valign="middle",o.wordWrap="true",o.text=r,console.log("总字数",r.length,g)}}class M extends Laya.Script{constructor(){super(),this.chatPanel=null,this.btn_Chat=null,this.btn_Fly=null,this.btn_Eat=null,this.btn_Sit=null,this.btn_Spin=null,this.btn_Roll=null,this.btn_Fear=null,this.btn_Bounce=null}onAwake(){this.btn_Chat.on(Laya.Event.CLICK,this,function(){this.chatPanel.visible=!this.chatPanel.visible}),this.btn_Fly.on(Laya.Event.CLICK,this.btn_Fly,function(){Laya.stage.event("Fly")}),this.btn_Eat.on(Laya.Event.CLICK,this.btn_Eat,function(){Laya.stage.event("Eat"),console.log("Eat")}),this.btn_Sit.on(Laya.Event.CLICK,this.btn_Sit,function(){Laya.stage.event("Sit"),console.log("Sit")}),this.btn_Spin.on(Laya.Event.CLICK,this.btn_Spin,function(){Laya.stage.event("Spin"),console.log("Spin")}),this.btn_Roll.on(Laya.Event.CLICK,this.btn_Roll,function(){Laya.stage.event("Roll"),console.log("Roll")}),this.btn_Fear.on(Laya.Event.CLICK,this.btn_Fear,function(){Laya.stage.event("Fear"),console.log("Fear")}),this.btn_Bounce.on(Laya.Event.CLICK,this.btn_Bounce,function(){Laya.stage.event("Bounce"),console.log("Bounce")}),this.owner.on(Laya.Event.CLICK,this,function(){Laya.stage.event("UpdateMotion_start"),console.log("UpdateMotion_start")})}}class E{static init(){let e=Laya.ClassUtils.regClass;e("scripts/Logic/FightScene.js",t),e("scripts/UI/LoginPanel.js",n),e("scripts/UI/RegistPanel.js",o),e("scripts/UI/TextHint.js",r),e("scripts/Logic/LaunchGame.js",y),e("scripts/UI/MatchSceneUI.js",L),e("scripts/UI/SpeciesChangePanel.js",p),e("scripts/UI/MatchScene.js",m),e("scripts/Logic/TestScene.js",f),e("scripts/Logic/Joystick.js",C),e("scripts/Logic/ChatView.js",v),e("scripts/Logic/GamePanel.js",M)}}E.width=1920,E.height=1080,E.scaleMode="fixedwidth",E.screenMode="horizontal",E.alignV="middle",E.alignH="center",E.startScene="FightScene.scene",E.sceneRoot="",E.debug=!1,E.stat=!1,E.physicsDebug=!1,E.exportSceneToJson=!0,E.init();new class{constructor(){window.Laya3D?Laya3D.init(E.width,E.height):Laya.init(E.width,E.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=E.scaleMode,Laya.stage.screenMode=E.screenMode,Laya.stage.alignV=E.alignV,Laya.stage.alignH=E.alignH,Laya.URL.exportSceneToJson=E.exportSceneToJson,(E.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),E.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),E.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){E.startScene&&Laya.Scene.open("LoginScene.json")}}}();